library(gbif.range)
library(terra)
library(sp)

shp_eco_marine <- read_bioreg("eco_marine")
plot(shp_eco_marine[shp_eco_marine$REALM %in% c('Tropical Atlantic','Temperate South America','Temperate Northern Atlantic'),])
carib <- click(shp_eco_marine[shp_eco_marine$REALM %in% c('Tropical Atlantic','Temperate South America','Temperate Northern Atlantic'),], n=19)
write.table(carib, '~/scripts/USF_Library_Ogden_Collection_resources/shiny_annotation/dev/carib.tsv', sep='\t', quote=FALSE, row.names=FALSE)
# plot(shp_eco_marine[shp_eco_marine$ECO_CODE %in% carib$ECO_CODE,])

caribmerged <- aggregate(shp_eco_marine[shp_eco_marine$ECO_CODE %in% carib$ECO_CODE,])
countries <- geodata::world(path = tempdir())
marine <- buffer(terra::erase(caribmerged, countries), 1000) # get exact land borders, then give a 1km buffer back and don't bother filtering out islands
simpleMarine <- simplifyGeom(fillHoles(marine), 0.2)

writeVector(simpleMarine, '~/scripts/USF_Library_Ogden_Collection_resources/shiny_annotation/dev/carib.json')

# basis_of_record filter should help ensure no poorly cleaned DNA records or museum or zoo specimens are included
# still could include observations of fossils; not sure yet how to filter those out
# json pasted in geometry window at https://www.gbif.org/occurrence/taxonomy, then clicking 'occurrence status: present' and then 'basis_of_record: HUMAN_OBSERVATION', and then download -> species list
# https://www.gbif.org/occurrence/download?basis_of_record=HUMAN_OBSERVATION&has_coordinate=true&has_geospatial_issue=false&geometry=MULTIPOLYGON(((-94.74294%2018.38653,-94.32477%2018.1601,-92.00737%2018.69053,-91.52196%2018.43903,-90.71388%2019.35493,-90.31255%2021.01598,-88.1371%2021.61469,-87.01543%2021.54876,-86.7643%2021.12239,-87.7456%2019.66932,-87.42351%2019.58632,-87.84862%2018.2207,-88.06582%2018.8704,-88.40748%2018.38043,-88.10497%2018.31813,-88.24045%2016.94166,-88.92152%2015.90137,-88.15264%2015.67249,-85.02825%2015.97694,-84.30904%2015.80689,-83.94194%2015.49916,-84.09742%2015.32875,-83.41857%2015.25933,-83.21511%2014.30508,-83.62233%2013.651,-83.88224%2011.29387,-82.11288%208.92375,-81.19899%208.77815,-79.61923%209.60694,-79.02863%209.55571,-78.04912%209.23742,-76.78734%207.89715,-76.923%208.55795,-75.60944%209.44788,-75.25404%2010.79339,-74.8513%2011.09478,-74.37099%2010.73708,-74.18087%2011.29152,-73.25769%2011.28412,-71.66029%2012.44783,-71.12683%2012.08987,-71.97447%2011.55877,-71.5996%2010.69864,-72.13636%209.83178,-71.61378%209.02843,-71.05583%209.30788,-71.02131%209.72597,-71.55244%2010.78436,-70.00152%2011.50841,-68.83196%2011.43413,-68.10768%2010.47237,-66.22924%2010.63656,-65.15129%2010.03038,-63.68367%2010.47901,-64.26613%2010.64247,-61.93958%2010.70426,-62.79773%2010.56329,-62.67669%2010.22955,-60.88711%209.46138,-60.63298%208.54227,-60.15946%208.61173,-59.13217%208.02429,-58.50074%207.35415,-58.66091%206.39041,-58.31172%206.87291,-57.13098%205.87126,-54.31273%205.90354,-52.78841%205.31514,-51.66034%204.22625,-51.42455%204.37655,-50.59648%201.98659,-49.93313%201.69318,-50.01648%200.3102,-49.57539%200.37684,-49.32866%20-0.16986,-48.41069%20-0.26039,-47.98905%20-0.70463,-46.22826%20-0.90966,-45.31583%20-1.35639,-45.32264%20-1.75791,-45.15022%20-1.47875,-44.67903%20-1.58058,-44.39186%20-2.40851,-44.03815%20-2.50054,-44.2382%20-2.78374,-43.3265%20-2.3459,-42.19932%20-2.82713,-39.99569%20-2.84971,-38.4757%20-3.721,-37.16145%20-4.95431,-35.49168%20-5.16704,-34.82019%20-7.146,-35.0165%20-8.5603,-38.32191%20-12.91894,-38.7639%20-12.7052,-39.09134%20-13.8918,-38.8657%20-15.85655,-39.14824%20-17.68969,-39.64608%20-18.23457,-39.82494%20-19.64684,-41.07352%20-21.48457,-41.01011%20-22.01457,-41.96618%20-22.52597,-42.05974%20-22.94908,-43.03921%20-22.96799,-43.08569%20-22.66833,-43.28635%20-23.00715,-44.43096%20-22.94848,-45.40705%20-23.80485,-46.43821%20-23.93015,-47.86908%20-24.88459,-48.21541%20-25.44672,-48.3991%20-25.30348,-48.80838%20-28.59082,-45.82738%20-30.16565,-45.03818%20-27.36258,-42.83392%20-26.35126,-40.72099%20-26.12705,-36.6908%20-23.06103,-35.22235%20-22.59379,-32.94507%20-22.6194,-31.59865%20-23.64038,-29.80998%20-23.86822,-27.99448%20-23.31398,-26.75386%20-21.81006,-26.49932%20-20.52926,-26.75343%20-19.24977,-27.99122%20-17.74546,-29.84659%20-17.18341,-31.28982%20-17.31661,-32.69516%20-18.15429,-33.13791%20-18.77989,-35.45109%20-17.96452,-35.70684%20-16.97394,-35.63366%20-14.97548,-32.15613%20-10.42548,-31.57102%20-8.76673,-31.47434%20-7.09634,-30.02645%20-6.25606,-29.20872%20-4.91921,-29.16673%20-3.14168,-27.79442%20-2.42689,-26.88895%20-1.18878,-26.65179%200.61572,-27.38258%202.28108,-29.18896%203.42398,-31.41955%203.21246,-33.04543%201.62091,-33.37254%200.45723,-33.28442%20-0.68973,-35.08372%20-1.85998,-35.79007%20-1.75105,-38.71688%200.2036,-42.30427%200.77593,-43.63808%201.79028,-46.71825%202.64054,-48.61759%206.15611,-50.88318%208.05664,-53.50481%209.10502,-55.78419%209.28314,-57.12408%2010.66862,-56.19752%2012.25997,-56.34282%2014.40773,-57.71083%2015.9955,-57.9027%2017.59015,-59.50908%2020.10637,-62.14782%2021.6563,-64.28715%2022.05139,-66.99457%2021.8198,-67.51419%2022.15007,-68.40823%2023.74812,-71.12634%2025.22399,-72.09832%2026.46978,-73.60855%2027.27875,-74.59566%2028.89228,-76.19778%2029.97519,-77.47509%2030.24664,-73.15647%2032.84142,-72.41546%2033.97245,-72.13543%2035.32886,-75.41407%2035.27207,-78.74714%2033.79467,-79.91473%2032.67481,-80.82018%2032.4993,-81.51901%2030.9775,-80.04126%2026.79608,-80.45882%2025.2165,-81.08424%2025.12635,-80.97766%2025.35072,-81.79165%2026.09313,-82.09089%2026.95757,-82.29327%2026.84833,-82.66954%2027.48853,-82.39348%2027.88615,-82.83725%2027.87717,-82.63948%2028.91743,-83.99957%2030.10886,-85.30189%2029.69851,-86.25027%2030.49472,-87.65932%2030.25943,-88.0133%2030.69613,-88.12401%2030.36803,-89.35496%2030.37863,-89.86368%2030.01271,-89.47793%2029.98207,-89.73982%2029.59971,-89.17283%2029.04763,-90.21139%2029.57013,-90.09469%2029.17171,-90.87335%2029.1394,-91.87786%2029.84328,-92.31567%2029.54111,-93.20892%2029.78424,-94.74801%2029.53911,-94.73986%2029.79696,-95.39125%2028.87529,-96.65157%2028.71869,-96.41988%2028.45373,-97.13572%2028.15199,-97.64233%2027.32459,-97.15403%2025.88876,-97.36191%2025.37704,-97.7344%2025.33683,-97.86362%2022.37623,-96.31173%2019.32789,-95.81821%2018.73754,-94.74294%2018.38653)),((-66.80857%2029.5387,-65.93001%2029.0682,-64.48446%2028.90281,-62.27481%2029.96167,-61.55114%2031.04486,-61.33324%2032.81335,-62.10647%2034.50674,-62.7473%2035.08278,-64.19639%2035.64449,-65.45245%2035.59648,-66.66793%2035.07742,-67.61572%2034.14939,-68.10004%2033.13137,-68.2012%2031.92009,-67.78677%2030.60692,-66.80857%2029.5387)))&occurrence_status=present
# GBIF.org (16 September 2024) GBIF Occurrence Download  https://doi.org/10.15468/dl.qn7z5v
# to use this dataset, gbif needs to be cited: https://www.gbif.org/terms/data-user
# file 0018230-240906103802322.csv
# will want to do this with code... https://techdocs.gbif.org/en/data-use/api-downloads

